<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ukubona Pentad — Five Mode Map (+ Schrödinger / Dynamometer)</title>
<style>
  :root{
    --bg:#0b0d0f; --soil:#2c2b28; --root:#7b4b2a; --trunk:#6b523f;
    --branch:#2f5f3b; --canopy:#51a06a; --haze:#7fcaa0; --fruit:#e55b58;
    --seed:#f1c84e; --life:#5dd69b; --recur:#e56a6a; --text:#e7efe9; --dim:#a9b6ae;
    --focus:#9fe8c6; --panel:#0b0d0f; --stroke:#1f2326; --accent:#8ee8ff;
    --gauge:#8ee8ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    color:var(--text); background: radial-gradient(1200px 900px at 50% 0%, #0e1113, var(--bg));
  }
  .wrap{max-width:1200px;margin:0 auto;padding:20px}
  .card{background:#0a0c0e; border:1px solid var(--stroke); border-radius:16px; box-shadow:0 10px 40px rgba(0,0,0,.35); overflow:hidden}
  header{padding:20px 20px 0 20px}
  h1{font-size:22px; margin:0 0 4px}
  .sub{color:var(--dim); font-size:14px; margin:0 0 12px}
  .controls{display:flex; gap:10px; flex-wrap:wrap; padding:0 20px 10px}
  .chip{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:12px; border:1px solid #2a2f33; background:#0e1114; color:#cfd8d2; font-size:12px}
  button.chip{cursor:pointer}
  svg{display:block; width:100%; height:72vh; background:linear-gradient(#0a0c0e,#0d1012)}
  .legend{display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:10px; padding:10px 20px 20px}
  .legend .sw{display:inline-block;width:24px;height:3px;border-radius:2px;margin-right:8px;vertical-align:middle}
  .sheet{position: fixed; top:0; right:-460px; width:440px; max-width:92vw; height:100%; background:var(--panel); border-left:1px solid var(--stroke); box-shadow:-20px 0 60px rgba(0,0,0,.4); transition:right .35s ease; padding:22px; z-index:30; overflow:auto;}
  .sheet.open{ right:0; }
  .sheet h2{margin:0 0 6px; font-size:20px}
  .sheet .subline{color:var(--dim); margin:0 0 14px; font-size:13px}
  .sheet .body{line-height:1.6; font-size:14px; color:#ced7d1}
  .close{position:absolute; top:10px; right:14px; background:none; border:1px solid #2a2f33; color:#cfd8d2; border-radius:10px; padding:6px 10px; cursor:pointer}
  .halo{pointer-events:none}
  .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:12px; padding:.1em .35em; border:1px solid #2a2f33; border-radius:6px; background:#0f1316}
  .hint{color:#a9b6ae; font-size:12px}
  .badge{display:inline-block; padding:2px 6px; border:1px solid #2a2f33; border-radius:8px; font-size:11px; margin-right:6px}
  .foot-chorus{max-width:1200px;margin:14px auto 40px; padding:8px 16px; font-size:12px; color:#bcd6cd; opacity:.9}
  .foot-chorus p{margin:6px 0}
  .pill{display:inline-block; padding:2px 8px; border:1px solid #2a2f33; border-radius:999px; font-size:11px; margin:0 6px 0 0; color:#a9b6ae}
  .hr{height:1px; background:#20262a; margin:14px 0}
  .ul{padding-left:18px}
  .ul li{margin:8px 0}

  /* --- Nudge Library styles --- */
  .nudges{display:grid; grid-template-columns:1fr; gap:10px; margin-top:8px}
  .nudge{border:1px solid #223038; border-radius:12px; padding:10px; background:#0b1114}
  .nudge h4{margin:0 0 6px; font-size:14px}
  .nudge small{color:#8fa7a0}
  .nudge .row{margin:6px 0}
  .nudge .lbl{display:inline-block; min-width:78px; color:#a9b6ae}
  .copy{margin-top:8px; display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:8px; border:1px solid #2a2f33; background:#0e1316; color:#cfe0d8; font-size:12px; cursor:pointer}
  .copy:active{transform:translateY(1px)}
  .ok{border-color:#2a4; color:#bfe5c8}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <h1>Ukubona Pentad — Five Mode Map</h1>
        <p class="sub" id="subtitle">Mode: <strong>Life Stages</strong> — fractal role of <strong>Ukubona LLC</strong> within a five-company stack. Press <span class="kbd">M</span> to switch modes.</p>
      </header>

      <div class="controls">
        <span class="chip"><span class="sw" style="background:var(--life)"></span>Life arc</span>
        <span class="chip"><span class="sw" style="background:var(--recur)"></span>Recursion (thin, dashed)</span>
        <button class="chip" id="mode">⇄ Switch Mode</button>
        <button class="chip" id="randomize">↻ Randomize branches</button>
        <span class="chip"><span class="sw" style="background:var(--gauge)"></span>Dynamometer (2025)</span>
        <span class="chip"><span class="sw" style="background:var(--accent)"></span>Schrödinger Pentad</span>
        <button class="chip" id="togglePrompts">❓ Panel Prompts</button>
      </div>

      <svg id="scene" viewBox="0 0 1000 1200" role="img" aria-label="Ukubona Truth Tree">
        <rect x="0" y="1150" width="1000" height="16" fill="var(--soil)" opacity=".18"/>
        <rect x="0" y="1132" width="1000" height="16" fill="var(--soil)" opacity=".14"/>
        <rect x="0" y="1114" width="1000" height="16" fill="var(--soil)" opacity=".10"/>
        <g id="tree"></g>
        <defs>
          <marker id="arrowTip" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto-start-reverse">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="var(--life)" />
          </marker>
          <marker id="arrowThin" markerWidth="8" markerHeight="8" refX="4" refY="4" orient="auto-start-reverse">
            <path d="M 0 0 L 8 4 L 0 8 z" fill="var(--recur)" />
          </marker>
        </defs>
        <path id="lifeArc" d="M 880,1120 C 960,780 960,420 880,200" stroke="var(--life)" stroke-width="6" fill="none" marker-end="url(#arrowTip)" opacity=".95"/>
        <text x="930" y="600" transform="rotate(-90 930 600)" text-anchor="middle" fill="#9fe8c6" font-size="20">Younger → Older</text>
        <path id="recurArc" d="M 120,200 C 40,420 40,780 120,1120" stroke="var(--recur)" stroke-width="3" stroke-dasharray="10 10" fill="none" marker-end="url(#arrowThin)" opacity=".9"/>
        <text x="70" y="600" transform="rotate(90 70 600)" text-anchor="middle" fill="#f3a2a2" font-size="14">Recursion → next cycle</text>
      </svg>

      <div class="legend" id="legend"></div>
    </div>
    <p class="hint">Tip: click any ring to open details (and prompts if enabled). Press <span class="kbd">R</span> to randomize branches, <span class="kbd">M</span> to toggle modes.</p>
  </div>

  <aside id="sheet" class="sheet" aria-hidden="true">
    <button class="close" id="closeSheet">Close</button>
    <h2 id="sTitle">Layer</h2>
    <p id="sSub" class="subline"></p>
    <div id="sBody" class="body"></div>
    <div class="hr"></div>
    <div id="sPrompts" class="body" style="display:none"></div>
    <p id="sMeta" class="subline" style="margin-top:16px; font-style:italic"></p>
  </aside>

  <div class="foot-chorus">
    <p><em>This is play, not prescription. This is rehearsal, not remedy. This is simulation, not salvation.</em></p>
  </div>

<script>
  // ---------- Data ----------
  function getVar(name){ return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }

  // LIFE STAGES
  const LIFE = [
    { key:"roots",  title:"Roots / Ukuvula",  subtitle:"Diet — Foundation",
      meta:"Provisioning — energy & matter from earth & sun",
      y:1120, color:getVar("--root"),
      body:`Infancy & Early Childhood — Intake, sensory learning, nutrition. All later growth is contingent on richness and balance here.` },
    { key:"trunk",  title:"Trunk / Ukuzula",  subtitle:"Fitness — Structure",
      meta:"Embodiment — capacity, stamina, coordination",
      y:930, color:getVar("--trunk"),
      body:`Childhood → Adolescence — Building strength, stability, and motor intelligence. Movement is the conduit between environment and self.` },
    { key:"branch", title:"Branching / Ukukona", subtitle:"Games — Exploration",
      meta:"Cognition & culture — agency & strategy",
      y:760, color:getVar("--branch"),
      body:`Young Adulthood — Cognitive/social exploration; testing rules and inventing new ones. Divergence and emergent strategy take root.` },
    { key:"canopy", title:"Canopy / Ukubona", subtitle:"Health — Integration",
      meta:"Whole-system perception — context & horizon",
      y:570, color:getVar("--canopy"),
      body:`Mature Adulthood — Integrating domains into a coherent worldview of wellbeing. Decisions with context and longer horizons.` },
    { key:"fruit",  title:"Fruit / Ukukula",  subtitle:"Aging — Legacy",
      meta:"Recursion — harvest → seeds → next cycle",
      y:380, color:getVar("--fruit"),
      body:`Elderhood — Harvest and recursion. Knowledge transfer, mentoring, and seeding the next generation with embodied wisdom.` },
  ];

  // EMERGENT REALMS
  const REALMS = [
    { key:"roots",  title:"Physics (Roots)",  subtitle:"Ontology — constraints",
      meta:"Conservation, symmetry, interactions",
      y:1120, color:getVar("--root"),
      body:`First principles set the filesystem of reality. Material/energetic substrate enables everything above.` },
    { key:"trunk",  title:"Biology (Trunk)",  subtitle:"Epistemology — bounded mind",
      meta:"Embodied sensing; limited bandwidth & context length",
      y:930, color:getVar("--trunk"),
      body:`Life must perceive, filter, and make meaning to survive under constraints, turning sensing into adaptive knowledge.` },
    { key:"branch", title:"Social (Branching)", subtitle:"Agency — feedback loops",
      meta:"Cooperation, competition, signaling, trust",
      y:760, color:getVar("--branch"),
      body:`Multiple agents with overlapping but distinct goals form norms, institutions, and collective memory across scales.` },
    { key:"canopy", title:"Mathematical (Canopy)", subtitle:"Simulation — compressed time",
      meta:"Abstraction, generalization, optimization",
      y:570, color:getVar("--canopy"),
      body:`Models accelerate exploration by trading fidelity for tractability; parallel twins let us rehearse futures before acting.` },
    { key:"fruit",  title:"Computational (Fruit)",  subtitle:"Strategic intelligence — recursion",
      meta:"Algorithms encode fruit→seed logic",
      y:380, color:getVar("--fruit"),
      body:`Architectures that reuse information and recurse can self-improve and seed subsequent cycles — nature formalized.` },
  ];

  // PLANT → ANIMAL → MAN → EQUATIONS → AI
  const PLANT_AI = [
    { key:"roots",  title:"Plant (Roots)", subtitle:"Biology-as-physics",
      meta:"Phototrophy, distributed sensing",
      y:1120, color:getVar("--root"),
      body:"Energy capture, structural growth, environmental sensing without locomotion." },
    { key:"trunk",  title:"Animal (Trunk)", subtitle:"Biology",
      meta:"Locomotion, nervous coordination",
      y:930, color:getVar("--trunk"),
      body:"Mobility, adaptive behavior, predator–prey arms races." },
    { key:"branch", title:"Man (Branching)", subtitle:"Social",
      meta:"Language, culture, tools",
      y:760, color:getVar("--branch"),
      body:"Symbolic thought, cooperation, institutions." },
    { key:"canopy", title:"Equations (Canopy)", subtitle:"Mathematical",
      meta:"Abstraction, generalization",
      y:570, color:getVar("--canopy"),
      body:"Predictive models, optimization, compressed time." },
    { key:"fruit",  title:"AI (Fruit)", subtitle:"Computational",
      meta:"Recursion, synthetic learning",
      y:380, color:getVar("--fruit"),
      body:"Self-iterating intelligences, novel ontologies." }
  ];

  // PENTAD COMPANIES
  const PENTAD = [
    { key:"roots",  title:"Ukuvula — Provisioning", subtitle:"Roots (0→) — Food, environment, determinants",
      meta:"Company 1 of 5 — Foundation / North America→Global",
      y:1120, color:getVar("--root"),
      body:`Provisioning of energy & matter: nutrition, housing, environment. Interfaces with public health & retail supply chains.` },
    { key:"trunk",  title:"Ukuzula — Mobility & Fitness Analytics", subtitle:"Trunk (movement)",
      meta:"Company 2 of 5 — Wearables, gait, VO₂ proxy",
      y:930, color:getVar("--trunk"),
      body:`Mobility telemetry: walking speed distributions, step cadence, lower-bound vitality estimates. Feeds risk engines across ages.` },
    { key:"branch", title:"Ukukona — Play & Games", subtitle:"Branching (experimentation)",
      meta:"Company 3 of 5 — Behavioral economics & habit loops",
      y:760, color:getVar("--branch"),
      body:`Behavior shaping via games, social incentives, and micro-commitments. Experimentation layer for population-scale habit change.` },
    { key:"canopy", title:"Ukubona — Health Integration (Nervous System)", subtitle:"Canopy (integration)",
      meta:"Company 4 of 5 — System orchestration / beyond the brain",
      y:570, color:getVar("--canopy"),
      body:`Network (Beyond the Brain) — Systemic Regulation: aggregates tactical, informational, and strategic inputs into operational code; coordinates payers, providers, rehab, and home care to preserve agency.` },
    { key:"fruit",  title:"Ukukula — Aging & Legacy",  subtitle:"Fruit (recursion)",
      meta:"Company 5 of 5 — Frailty prevention, end-of-life dignity",
      y:380, color:getVar("--fruit"),
      body:`Aging pipeline — combining Fried’s frailty phenotype (75+) with lifelong wearable-derived vitality metrics; supports decisions around ADLs, dignity thresholds (<0), and family network impacts.` },
  ];

  // GAMES (God, Animal, Man, Enterprise, System)
  const GAMES = [
    { key:"roots",  title:"God (Roots)", subtitle:"Meaning of the earth → ground of value",
      meta:"Cosmos, constraint, sacred substrate",
      y:1120, color:getVar("--root"),
      body:`Primordial order and limit. The pre-contract that reality writes: thermodynamics, time, and scarcity. Nietzsche’s earth against sky-castles.` },
    { key:"trunk",  title:"Animal (Trunk)", subtitle:"Embodiment — instinct & movement",
      meta:"Perception–action loops; survival",
      y:930, color:getVar("--trunk"),
      body:`Drives, fitness, and bounded rationality. Where vitality is computed in gait, cadence, and recovery.` },
    { key:"branch", title:"Man (Branching)", subtitle:"Agency — culture & tools",
      meta:"Language, coordination, institutions",
      y:760, color:getVar("--branch"),
      body:`Symbolic play and norm-making. The worker/serf/API roles arise here—interfaces between will and infrastructure.` },
    { key:"canopy", title:"Enterprise (Canopy)", subtitle:"Organization — projects & platforms",
      meta:"Firms, platforms, governance",
      y:570, color:getVar("--canopy"),
      body:`Collective intent scaled. Platforms compress many human games into protocols; capital and code braid together.` },
    { key:"fruit",  title:"System (Fruit)", subtitle:"Orchestration — recursion & emergence",
      meta:"Feedback, resilience, self-improvement",
      y:380, color:getVar("--fruit"),
      body:`When platforms harden into environments that write their own successors. The API gives way to the ecology; the double-helix of production relations and value-creation twists into continuous redesign.` },
  ];

  // DYNAMOMETER (2025)
  const DYNAMO = [
    { key:"roots", title:"Zeroth Principle", subtitle:"Absolute zero is unattainable",
      meta:"All that exists is flow down gradients",
      y:1120, color:getVar("--root"), gauge:0.15,
      body:`Foundation: gradients everywhere; no stillness. Aesthetic vitality = distance from zero.` },
    { key:"trunk", title:"Gradients in Biology", subtitle:"Frailty ↔ Vitality",
      meta:"Fried phenotype ↔ wearables (gait, HRV)",
      y:930, color:getVar("--trunk"), gauge:0.25,
      body:`Vitality measured as movement and recovery. Dynamometer at the organism level.` },
    { key:"branch", title:"Ukukona — Collisions", subtitle:"Venture, research, talent",
      meta:"Creative destruction; games of agency",
      y:760, color:getVar("--branch"), gauge:0.45,
      body:`Collision theatre: Silicon Valley & global AI labs. Fertile when friction is high; ugly when bloat stalls flow.` },
    { key:"canopy", title:"Microsoft — Emergence (2025)", subtitle:"Order that amplifies power",
      meta:"Ecosystems, standards, cloud",
      y:570, color:getVar("--canopy"), gauge:0.85,
      body:`Ecosystem returns from AI spend become visible: cloud growth accelerates; capital outlays expand the field. Emergence reads as vitality on the gauge.` },
    { key:"fruit", title:"NVIDIA — Recursion (2025)", subtitle:"GPUs → AI → GPUs",
      meta:"Feedback loop driving the stack",
      y:380, color:getVar("--fruit"), gauge:1.00,
      body:`Recursion loop drives the whole stack. Off-scale vitality as supply, demand, and compute co-accelerate.` },
  ];

  // SCHRÖDINGER PENTAD
  const SCHRO = [
    { key:"roots", title:"DNA (Unattainable)", subtitle:"Code-as-potential — box unopened",
      meta:"Platonic ideal vs. Heraclitean flux",
      y:1120, color:getVar("--root"),
      body:`Perfect information imagined, never frozen in reality. Mutations & epigenetics keep it in motion.`},
    { key:"trunk", title:"ATP (Gradients)", subtitle:"Energy differences drive life",
      meta:"Proton pumps, membrane potentials",
      y:930, color:getVar("--trunk"),
      body:`Vitality = strength of gradients. No flow, no life; absolute zero is unattainable.`},
    { key:"branch", title:"Silicon Valley (Collisions) / Ukukona", subtitle:"Chaotic flux of ideas & failure",
      meta:"Creative destruction; agency games",
      y:760, color:getVar("--branch"),
      body:`Beauty = dynamism & fertility; ugliness = stagnation & bloat. Collision is health.`},
    { key:"canopy", title:"Microsoft (Emergence)", subtitle:"Order that amplifies power",
      meta:"Ecosystems, standards, cloud",
      y:570, color:getVar("--canopy"),
      body:`From collisions to coherent platforms. Emergent order reads as vitality on the gauge.`},
    { key:"fruit", title:"NVIDIA (Recursion)", subtitle:"GPUs → AI → GPUs",
      meta:"Supply↔demand tightening the loop",
      y:380, color:getVar("--fruit"),
      body:`Self-acceleration via recursion; off-scale gauge when the loop closes faster than governance can adapt.`},
  ];

  // ---------- Panel Prompts (Pam) ----------
  const PROMPTS_GENERIC = {
    roots: [
      ["Name the hard constraint.", "What physics/infra bottleneck gates outcomes? (e.g., cold chain, road access, spectrum)"],
      ["Quantify the gradient.", "How big is the 'today→target' delta we’re financing?"],
      ["Price the error.", "What’s the climate/FX/operational buffer baked into terms?"],
      ["Minimum viable collision.", "Which two actors must meet to unlock flow?"]
    ],
    trunk: [
      ["Match cashflows to biology.", "Do grace periods and amortization align with actual cycles (harvest, recovery, school terms)?"],
      ["Instrument vitality.", "Which telemetry (gait, HRV, uptime) feeds risk/repricing?"],
      ["Reduce friction, not IQ.", "What process step are we deleting for users (forms, travel, queues)?"],
      ["Skill as capex.", "What training is bundled and who pays on failure?"]
    ],
    branch: [
      ["Force productive collisions.", "Which interfaces are contractually required (API, coop, public capex hook)?"],
      ["Finance the delta, not the logo.", "Show the KPI pattern you fund (e.g., post-harvest loss ↓, export $/kWh ↑)."],
      ["Experiment safely.", "What learning tranche flips based on observed behavior?"],
      ["Steer the crowd.", "What nudge/game mechanic makes the right action default?"]
    ],
    canopy: [
      ["Publish the pattern.", "Which 3 shared KPIs roll up across projects?"],
      ["Sequence public→private.", "What public milestone unblocks disbursement?"],
      ["Who owns the switch?", "Which pre-committed rule adjusts terms when shocks hit?"],
      ["Data as collateral.", "Which datasets lower next-cycle pricing?"]
    ],
    fruit: [
      ["Close the loop.", "Where do repayments/data recycle into cheaper capital?"],
      ["Hazard & survival.", "Show h(t)/S(t) curves—where does hazard spike?"],
      ["Legacy without lock-in.", "How do we avoid platform ossification?"],
      ["Seed the next cycle.", "What’s the handoff to new entrants/regions?"]
    ]
  };

  // --- Nudge/Game Mechanic Library (shown on BRANCH layer) ---
  const NUDGES = [
    {
      name: "One-tap default",
      def: "Primary action pre-selected; confirm to proceed.",
      when: "Low-risk, frequent behaviors (check-in, hydrate, take walk).",
      measure: "Completion rate, time-to-action.",
      guard: "Easy, visible undo; rate-limit auto-nudges.",
      snippet: `Default: preselect 'good' action; one-tap confirm.\nWhen: low-risk, high-frequency steps.\nMeasure: completion %, time-to-act.\nAnti-abuse: clear undo + rate limits.`
    },
    {
      name: "Soft pre-commit",
      def: "Tiny pledge (no deposit) with public micro-signal.",
      when: "New habit start; early cohorts.",
      measure: "7/28-day retention, streak length.",
      guard: "One-click opt-out; no shaming copy.",
      snippet: `Default: pledge on by default; user can opt out.\nWhen: habit formation kickoff.\nMeasure: D7/D28 retention, streak.\nAnti-abuse: opt-out visible; neutral tone.`
    },
    {
      name: "Social proof ribbon",
      def: "Show ‘Most peers choose X’ inline.",
      when: "Ambiguity; many acceptable options.",
      measure: "Choice share shift vs. control.",
      guard: "Never fabricate; cap % text.",
      snippet: `Default: display peer majority for target choice.\nWhen: ambiguous decisions.\nMeasure: delta in selection share.\nAnti-abuse: audited counts; avoid overclaim.`
    },
    {
      name: "Loss-framed escrow",
      def: "Tiny refundable hold released on completion.",
      when: "Medium-stakes tasks; motivated users.",
      measure: "Completion %, refund rate.",
      guard: "Hard cap; hardship bypass.",
      snippet: `Default: small refundable hold; auto-release on done.\nWhen: medium-stakes tasks.\nMeasure: completion %, refunds.\nAnti-abuse: caps + bypass routes.`
    },
    {
      name: "Cooldown & lock-in",
      def: "Default keeps good choice; reverse requires pause.",
      when: "Prevent backsliding after success.",
      measure: "Reversion rate, relapse cycles.",
      guard: "Visible timer; emergency override.",
      snippet: `Default: keep good state; reversal waits cooldown.\nWhen: post-success consolidation.\nMeasure: relapse rate.\nAnti-abuse: show timer; override for emergencies.`
    },
    {
      name: "Deadline with soft auto-submit",
      def: "If silent at T, submit best-known ‘good’ draft.",
      when: "Docs/forms that decay with delay.",
      measure: "On-time share, correction rate.",
      guard: "Preview window; easy retract.",
      snippet: `Default: auto-submit at deadline if silent.\nWhen: forms where delay hurts.\nMeasure: on-time %, edits-after.\nAnti-abuse: preview + retract window.`
    },
    {
      name: "Lottery micro-incentive",
      def: "Tiny EV boost via randomized reward for ‘good’.",
      when: "Low-cost, high-engagement tasks.",
      measure: "Task picks per user/day.",
      guard: "Transparent odds; EV disclosure.",
      snippet: `Default: entry to small lottery on completion.\nWhen: low-cost engagement.\nMeasure: completions/user.\nAnti-abuse: publish odds + EV.`
    },
    {
      name: "Bucketed friction",
      def: "Add micro-friction to bad choice only.",
      when: "We want deterrence, not bans.",
      measure: "Bad-choice drop-off.",
      guard: "Accessibility-safe; time caps.",
      snippet: `Default: extra step only on bad choice.\nWhen: deter without banning.\nMeasure: bad-choice rate.\nAnti-abuse: a11y checks; cap delay.`
    }
  ];

  function renderPrompts(list){
    const ul = document.createElement("ul"); ul.className="ul";
    list.forEach(([q,ex])=>{
      const li=document.createElement("li");
      li.innerHTML = `<strong>${q}</strong><br/><em>${ex}</em>`;
      ul.appendChild(li);
    });
    return ul.outerHTML;
  }

  function renderNudges(){
    const wrap = document.createElement("div");
    wrap.innerHTML = `<div class="pill">Nudge Library — “make right action default”</div>`;
    const grid = document.createElement("div"); grid.className = "nudges";
    NUDGES.forEach(n=>{
      const card = document.createElement("div"); card.className="nudge";
      card.innerHTML = `
        <h4>${n.name}</h4>
        <div class="row"><span class="lbl">Default</span> <small>${n.def}</small></div>
        <div class="row"><span class="lbl">When</span> <small>${n.when}</small></div>
        <div class="row"><span class="lbl">Measure</span> <small>${n.measure}</small></div>
        <div class="row"><span class="lbl">Anti-abuse</span> <small>${n.guard}</small></div>
        <button class="copy" data-snippet="${n.snippet.replace(/"/g,'&quot;')}">Copy template</button>
      `;
      grid.appendChild(card);
    });
    wrap.appendChild(grid);
    // delegate copy handlers
    setTimeout(()=>{
      wrap.querySelectorAll(".copy").forEach(btn=>{
        btn.addEventListener("click", async (e)=>{
          const s = btn.getAttribute("data-snippet");
          try{
            await navigator.clipboard.writeText(s);
            btn.classList.add("ok"); btn.textContent="✓ Copied";
            setTimeout(()=>{ btn.classList.remove("ok"); btn.textContent="Copy template"; }, 1200);
          }catch(err){
            // fallback: select & copy via textarea
            const ta=document.createElement("textarea"); ta.value=s; document.body.appendChild(ta);
            ta.select(); document.execCommand("copy"); document.body.removeChild(ta);
            btn.classList.add("ok"); btn.textContent="✓ Copied";
            setTimeout(()=>{ btn.classList.remove("ok"); btn.textContent="Copy template"; }, 1200);
          }
        });
      });
    },0);
    return wrap.outerHTML;
  }

  // ---------- SVG helpers ----------
  const svgNS = "http://www.w3.org/2000/svg";
  const tree = document.getElementById("tree");
  const subtitle = document.getElementById("subtitle");
  const sheet = document.getElementById("sheet");
  const sTitle = document.getElementById("sTitle");
  const sSub   = document.getElementById("sSub");
  const sBody  = document.getElementById("sBody");
  const sMeta  = document.getElementById("sMeta");
  const sPrompts = document.getElementById("sPrompts");
  let PROMPTS_ON = true;

  document.getElementById("closeSheet").onclick = () => sheet.classList.remove("open");
  document.getElementById("togglePrompts").onclick = () => {
    PROMPTS_ON = !PROMPTS_ON;
    document.getElementById("togglePrompts").textContent = PROMPTS_ON ? "❓ Panel Prompts" : "❔ Prompts Off";
    if(!PROMPTS_ON) sPrompts.style.display="none";
  };

  function cbez(p0,p1,p2,p3){ return `M ${p0[0]},${p0[1]} C ${p1[0]},${p1[1]} ${p2[0]},${p2[1]} ${p3[0]},${p3[1]}`; }
  function r(seed){ seed = (seed*16807)%2147483647; return () => (seed = (seed*16807)%2147483647)/2147483647; }

  let MODE = 0; // 0=Life, 1=Realms, 2=Plant→AI, 3=Pentad, 4=GAMES, 5=DYNAMO, 6=SCHRO
  const MODE_NAMES = ["Life Stages", "Emergent Realms", "Plant → AI", "Pentad Companies", "GAMES Pentad", "Dynamometer (2025)", "Schrödinger Pentad"];

  function active(){ return [LIFE, REALMS, PLANT_AI, PENTAD, GAMES, DYNAMO, SCHRO][MODE]; }

  function draw(seed=42){
    tree.innerHTML = ""; // clear
    const rand = r(seed);
    const W=1000, cx=W/2;

    // Trunk (layered Beziers for thickness)
    for(let j=0;j<5;j++){
      const jitter = (rand()-0.5)*10;
      const p0=[cx+jitter,1120-8];
      const p3=[cx+jitter,550];
      const p1=[cx-90+(rand()-0.5)*18,950];
      const p2=[cx+90+(rand()-0.5)*18,720];
      path(cbez(p0,p1,p2,p3), {stroke:getVar("--trunk"), "stroke-width":18-j*2.5, opacity:.55+j*.08});
    }

    // Roots (mirrored)
    for(let k=0;k<7;k++){
      const amp=240+k*28, base=1120-10;
      const p0=[cx,base];
      const p3L=[cx-(420-k*60), base+85+k*10];
      const p1L=[cx-(120+k*18), base+10+k*2];
      const p2L=[cx-amp, base+60+k*6];
      const p3R=[cx+(420-k*60), base+85+k*10];
      const p1R=[cx+(120+k*18), base+10+k*2];
      const p2R=[cx+amp, base+60+k*6];
      path(cbez(p0,p1L,p2L,p3L), {stroke:getVar("--root"), "stroke-width":6, opacity:.66});
      path(cbez(p0,p1R,p2R,p3R), {stroke:getVar("--root"), "stroke-width":6, opacity:.66});
    }

    // Branches (with offshoots + canopy haze)
    const levels=[800,720,650];
    levels.forEach((ly,i)=>{
      [-1,1].forEach(dir=>{
        const span=340-i*70;
        const p0=[cx,ly];
        const p3=[cx+dir*(span + (rand()*40)), ly-(40+i*25)];
        const p1=[cx+dir*(120+rand()*40), ly-10];
        const p2=[cx+dir*(240+rand()*40), ly-(25+i*20)];
        path(cbez(p0,p1,p2,p3), {stroke:getVar("--branch"), "stroke-width":10-i*2.5, opacity:.9});
        for(let rr=0;rr<2;rr++){
          const ox0=cx+dir*(180+rr*40+rand()*20);
          const oy0=ly-(10+rr*10);
          const ox3=cx+dir*(span*.78+rand()*30);
          const oy3=ly-(0+rr*18);
          const ox1=ox0+dir*(40+rand()*10);
          const oy1=oy0+8;
          const ox2=ox3-dir*(40+rand()*10);
          const oy2=oy3-6;
          path(cbez([ox0,oy0],[ox1,oy1],[ox2,oy2],[ox3,oy3]), {stroke:getVar("--branch"), "stroke-width":5-rr, opacity:.55});
          circle(ox3,oy3, 12+rand()*10, {fill:getVar("--canopy"), opacity:.08+rand()*.06});
        }
      });
    });

    // Canopy haze field
    for(let i=0;i<160;i++){
      const x=180+rand()*(W-360);
      const y=470+rand()*160;
      const rr=12+rand()*28;
      circle(x,y,rr,{fill:getVar("--haze"), opacity:.04+rand()*.06});
    }

    // Fruit + seeds
    for(let i=0;i<8;i++){
      const x=180+i*((W-360)/7);
      const y=320 + Math.sin(i*.8)*10;
      circle(x,y,14,{fill:getVar("--fruit")});
      circle(x,y+26,9.5,{fill:getVar("--seed"), opacity:.9});
    }

    // Hotspots + labels
    const cxLabel = W/2;
    active().forEach((layer)=>{
      circle(cxLabel,layer.y,54,{fill:"#ffffff", opacity:.02, class:"halo"});
      const baseStroke = ((MODE===3 || MODE===4) ? getVar("--accent") : layer.color);
      let strokeW = 10;
      if(MODE===5){ // dynamometer
        const g = (layer.gauge||0);
        strokeW = 10 + g*12; // up to 22px
      }
      circle(cxLabel,layer.y,38,{fill:"none", stroke: (MODE===5? getVar("--gauge") : baseStroke), "stroke-width":strokeW, opacity:.92});
      text(cxLabel, layer.y-72, layer.title, {fill:getVar("--text"), "font-size":22, anchor:"middle"});
      text(cxLabel, layer.y-48, layer.subtitle, {fill:getVar("--dim"), "font-size":14, anchor:"middle"});
      const hit=circle(cxLabel,layer.y,60,{fill:"#000", opacity:0, cursor:"pointer"});
      hit.addEventListener("click", ()=> openSheet(layer));
    });

    // Corner badges per mode
    if(MODE===3){
      cornerBadges([
        "Wearables (All ages): steps, HRV, sleep, cadence",
        "Frailty (75+): weight loss, grip, exhaustion, slowness, low activity"
      ]);
    }
    if(MODE===4){
      cornerBadges([
        "G = God → ground of value",
        "E/S = Enterprise/System: platforms → ecologies",
      ]);
    }
    if(MODE===5){
      cornerBadges([
        "Dynamometer: gauge = flow strength (distance from zero)",
        "Ukukona focus: collisions drive vitality (avoid bloat)"
      ]);
    }
    if(MODE===6){
      cornerBadges([
        "#schrödinger → DNA, ATP, Valley, Microsoft, NVIDIA",
        "Beauty = strong gradients; Ugliness = collapse toward stillness"
      ]);
    }
  }

  function cornerBadges(lines){
    const g = document.createElementNS(svgNS,'g');
    g.setAttribute('transform','translate(24,36)');
    const bg = document.createElementNS(svgNS,'rect');
    bg.setAttribute('x',0); bg.setAttribute('y',0); bg.setAttribute('rx',10);
    bg.setAttribute('width',360); bg.setAttribute('height', lines.length*22+18);
    bg.setAttribute('fill','#0b0f11'); bg.setAttribute('opacity','0.85');
    bg.setAttribute('stroke', getVar('--stroke'));
    g.appendChild(bg);
    lines.forEach((t,i)=>{
      const tx = document.createElementNS(svgNS,'text');
      tx.setAttribute('x',12); tx.setAttribute('y', 22 + i*22);
      tx.setAttribute('fill', '#bcd6cd'); tx.setAttribute('font-size','12');
      tx.textContent = '• ' + t; g.appendChild(tx);
    });
    document.getElementById('scene').appendChild(g);
  }

  function openSheet(layer){
    const isBranch = layer.key==="branch";
    sTitle.textContent = layer.title;
    sSub.textContent   = layer.subtitle;
    sBody.textContent  = layer.body;

    // choose prompts
    let prompts = PROMPTS_GENERIC[layer.key] || [];
    if(MODE===5 && layer.key==="branch"){
      // keep your sharp Ukukona prompts under Dynamometer if you add a mode-specific set later
    }

    if(PROMPTS_ON && prompts.length){
      sPrompts.style.display = "block";
      sPrompts.innerHTML =
        `<div class="pill">Pam Panel Prompts</div>` +
        renderPrompts(prompts) +
        (isBranch ? `<div class="hr"></div>${renderNudges()}` : ``) +
        `<div class="hr"></div><div class="pill">How to use</div> Click a ring, skim 4–5 bullets, pick 1 zinger to steer Q&A.`;
    } else {
      sPrompts.style.display = isBranch ? "block" : "none";
      sPrompts.innerHTML = isBranch ? renderNudges() : "";
    }

    const stackMeta = (MODE===3||MODE===4) ? " — Stack: 5 companies (Ukubona = nervous system). Region: North America → Global." : "";
    const dateMeta  = (MODE===5) ? " — Benchmarks illustrative for 2025." : "";
    sMeta.textContent  = "Meta: " + layer.meta + stackMeta + dateMeta;

    sheet.classList.add("open");
    sheet.setAttribute("aria-hidden","false");
  }

  // SVG builders
  function path(d, attrs){
    const el=document.createElementNS(svgNS,"path");
    el.setAttribute("d", d);
    el.setAttribute("fill","none");
    for(const k in attrs){ el.setAttribute(k, attrs[k]); }
    tree.appendChild(el);
    return el;
  }
  function circle(cx,cy,r,attrs){
    const el=document.createElementNS(svgNS,"circle");
    el.setAttribute("cx",cx); el.setAttribute("cy",cy); el.setAttribute("r",r);
    for(const k in attrs){ el.setAttribute(k, attrs[k]); }
    tree.appendChild(el); return el;
  }
  function text(x,y,str,attrs){
    const el=document.createElementNS(svgNS,"text");
    el.setAttribute("x",x); el.setAttribute("y",y);
    el.setAttribute("text-anchor", attrs.anchor||"start");
    delete attrs.anchor;
    for(const k in attrs){ el.setAttribute(k, attrs[k]); }
    el.textContent = str; tree.appendChild(el); return el;
  }

  function setMode(next){
    MODE = next;
    const btn = document.getElementById("mode");
    btn.textContent = "⇄ Switch Mode";
    subtitle.innerHTML = `Mode: <strong>${MODE_NAMES[MODE]}</strong> — fractal role of <strong>Ukubona LLC</strong> within a five-company stack. (press <span class="kbd">M</span> to switch)`;
    draw(Math.floor(Math.random()*1e6));
  }

  // init
  draw(42);
  document.getElementById("randomize").onclick = () => draw(Math.floor(Math.random()*1e6));
  document.getElementById("mode").onclick = () => setMode((MODE + 1) % 7);
  window.addEventListener("keydown", (e)=>{
    if(e.key.toLowerCase()==='r') draw(Math.floor(Math.random()*1e6));
    if(e.key.toLowerCase()==='m') setMode((MODE + 1) % 7);
    if(e.key==='Escape') sheet.classList.remove('open');
  });
</script>
</body>
</html>
